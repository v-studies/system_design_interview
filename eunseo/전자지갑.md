### 전자지갑

--> 계정 간 자금 이체 

트랜잭션을 지원하는 RDB 사용

<img width="544" height="304" alt="image" src="https://github.com/user-attachments/assets/6b441f5b-070c-4015-b856-5b7aee34442a" />


#### 분산 트랜잭션
(1) 2PC
두단계가 하나의 트랜잭션 (데이터베이스 자체에 의존)


1. 조정자(지갑 서비스)는 정상적으로 여러 디비에 읽기 및 쓰기 작업을 수행한다. → 데이터베이스 A/C에 락이 걸린다.
2. 애플리케이션이 트랜잭션을 커밋하려고 할 때, 조정자는 모든 디비에 트랜잭션 준비를 요청한다.
3. 두번째 단계에서 조정자는 모든 디비의 응답을 받아 다음 절차를 수행한다.
    - 모든 데이터베이스가 '예'라고 응답하면 조정자는 모든 디비에 해당 트랜잭션 커밋을 요청한다.
    - 어느 한 디비라도 '아니요'를 응답하면 조정자는 모든 디비에 트랜잭션 중단을 요청한다.



<img width="777" height="264" alt="image" src="https://github.com/user-attachments/assets/d39bca72-8dbe-4b0c-bdb0-4c48453af3c4" />

문제점 1) 다른 노드의 메시지를 기다리는 동안 락이 오랫동안 잠긴 상태로 남을 수 있어서 성능이 좋지 않다
문제점 2) 조정자가 SPOF, 단일 장애 지점(Single Point Of Failure)가 될 수 있다

(2) TC/C

두 단계로 구성된 보상 트랜잭션

1. 조정자는 모든 디비에 트랜잭션에 필요한 자원 예약을 요청한다.
2. 조정자는 모든 디비로부터 회신을 받는다.
    - 모두 '예'라고 응답하면 모든 디비에 작업 확인을 요청하는데, 이것이 바로 '시도-확정' 절차다.
    - 어느 하나라도 '아니요'라고 응답하면 조정자는 모든 디비에 작업 취소를 요청하며, 이것이 바로 '시도-취소' 절차다.


<img width="727" height="291" alt="image" src="https://github.com/user-attachments/assets/d3ddecc7-619c-4c6e-8434-8f5ce2d21253" />

첫번째 시도 단계에서 실패했을 때 ) 

<img width="737" height="215" alt="image" src="https://github.com/user-attachments/assets/63bbaea7-af4b-4276-ad1d-bcb02a1ec60c" />


<img width="777" height="195" alt="image" src="https://github.com/user-attachments/assets/4c8e8c62-d0e4-4f88-a827-1a6c96c85da7" />



(3) saga 

MSA 표준
<img width="655" height="361" alt="image" src="https://github.com/user-attachments/assets/24429867-2d91-4c0a-82ea-6f0e5931f6da" />
