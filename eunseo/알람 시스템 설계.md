![image](https://github.com/user-attachments/assets/553274b6-da23-4c9e-b6b0-f297a3adc0fb)

[그림 참조](https://seongho96.tistory.com/116)

1. API를 호출하여 알림 서버로 알림을 보낸다.
2. 알림 서버는 사용자 정보, 단말 토큰, 알림 설정 같은 메타데이터를 캐시나 데이터베이스에 가져온다.
3. 알림 서버는 전송할 알림에 맞는 이벤트를 만들어서 해당 이벤트를 위한 큐를 넣는다.
4. 작업 서버는 메시지 큐에서 알림 이벤트를 꺼낸다.
5. 작업 서버는 알림을 제3자 서비스로 보낸다.
6. 제3자 서비스는 사용자 단말로 알림을 전송한다.


분산 환경에서 안정성을 확보하기 위해 고려해야할 사항

1) 데이터 손실 방지
알림 내용이 소실되면 안되기 때문에 알림 데이터를 DB에 보관하고 재시도 메커니즘을 구현해야 한다.
-> 대부분 MQ에선 Retry, Dead Letter Queue 기능을 제공하기 때문에 로그 DB를 사용하지 않고 DLQ 기능을 사용해도 될 것 같다.

2) 알림 중복 전송 방지
알림 시스템을 분산 시스템으로 사용할 경우 분산 시스템 특성으로 가끔 알림이 중복된다.
이 중복은 100% 방지하기 어렵다고 한다.
중복을 최대한 방지하기 위해 알림의 이벤트 ID를 검사하는 매커니즘을 사용한다.
