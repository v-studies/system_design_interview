1단계. 문제 이해 및 설계 범위 확정
-------------------------------------
- URL 단축 : 주어진 긴 URL을 훨신 짧게 줄인다. (숫자와 영문자만 사용) 
- URL 리다이렉션 : 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내
- 높은 가용성과 규모 확장성, 그리고 장애 감내가 요구됨. 
  
###  개략적 추정
- 쓰기 연산: 매일 1억 개의 단축 URL 생성
- 초당 쓰기 연산: 1억(100million) / 24 / 3600 = 1160
- 읽기 연산 : 읽기 연산과 쓰기 연산 비율이 10:1 이라고 가정 -> 연산은 초당 1160×10= 11,600회 발생
- URL 단축 서비스를 10년간 운영한다고 가정하면 1억 × 365 × 10 = 3650억 개의 레코드를 보관 필요 
- 축약 전 URL의 평균 길이를 100이라고 가정
- 따라서 10년 동안 필요한 저장 용량은 3650억 × 100바이트 = 36.5TB

2단계. 개략적 설계안 제시 및 동의 구하기
-------------------------------------------
이번 단계에서는 API 엔드포인트, URL 리디렉션, URL 단축 플로우를 본다.

### API 엔드포인트
- URL 단축용 엔드포인트: POST /api/v1/data/shorten
  - 인자: 원래 URL 
  - 반환: 단축 URL

- URL 리디렉션용 엔드포인트: GET /api/v1/shortUrl
   - 반환: HTTP 리디렉션 목적지가 될 원래 URL

### URL 리디렉션
- 단축 URL을 받은 서버는 그 URL을 원래 URL로 바꾸어서 301 응답의 Location 헤더에 넣어 반환한다.
- 여기서 유의할 점은 301 응답과 302 응답의 차이다. 둘다 리디렉션 응답이긴 하지만 차이가 있다.
- 서버 부하를 줄이는 것이 중요: 301 Permanent moved 사용
- 트래픽 분석이 중요 (클릭 발생률, 발생위치 추적): 302 Found

### URL 단축 
- 단축 URL을 키로 하고, 원래 URL을 값으로 하는 해시테이블을 사용할 수 있다.
- www.tinyurl.com/[해시값]
- 입력으로 주어지는 긴 URL이 다른 값이면 해시 값도 달라야 한다.
- 계산된 해시 값은 원래 입력으로 주어졌던 긴 URL로 복원될 수 있어야 한다.

3단계. 상세 설계
-------------------------------------------
해시 테이블을 사용하면 메모리는 유한하고 비싸기 때문에 더 나은 방법은 <단축URL, 원래 URL>의 순서쌍을 관계형 데이터베이스에 저장하는 것이다.

### 해시 함수
- 원래 URL을 단축 URL로 변환하는 데 쓰인다.
- 편의상 해시함수가 계산하는 단축 URL 값을 hashValue라고 하겠다.([0-9, a-x, A-Z]의 문자 62개로 구성) 
- 62 ^ 7 = 3.5조 개로 요구사항을 만족시키기 충분한 값. 

### 해시 후 충돌 해소
- 긴 URL을 줄이려면 원래 URL을 7글자 문자열로 줄이는 해시함수가 필요하다.
- CRC32, MD5, SHA-1 해시 함수를 이용하고 계산된 해시값의 첫 7글자를 hashValue로 삼는 것이다.
- 이 방법을 적용하면 해시 충돌 확률이 높아진다. 충돌이 실제로 발생했을 경우, 충돌이 해소될 때까지 사전에 정한 문자열을 해시값에 덧붙인다. 
- 해시 충돌 발생을 감지하기 위해서는 DB에 질의를 할수 있는데 이것은 오베헤드가 크다.
- 데이터베이스 대신 블룸 필터를 사용해서 성능을 높일 수가 있다.

#### base-62 변환
- 진법 변환(base conversion)은 URL 단축기를 구현할 때 흔히 사용되는 접근법이다.
- 62진법을 사용하는 이유는 hashValue에 사용할 수 있는문자 개수가 62개이기 때문이다.
- 62은 수를 표현하기 위해 총 62개의 문자를 사용하는 진법이다. 따라서 0은 0으로, 9는 9로, 10은 a로, 11은 b로, ... 35는 z로 등등으로 대응시켜 표현하도록 할 것이다.
- 예시로 11157의 단축 URL은 https://tinyurl.com/2TX 가 된다.

![image](https://github.com/user-attachments/assets/514a3c20-83c1-41f1-af03-336c1b773f19)


URL 단축기 상세 설계 
- 입력으로 긴 URL을 받는다
- 데이터베이스에 해당 URL이 있는지 검사한다.
- 데이터베이스에 있다면 해당 URL에 대한 단축 URL을 만든 적이 있는 것이다. 따라서 해당 단축 URL을 그대로 반환한다.
- 데이터베이스에 없는 경우 유일한 ID를 생성한다. 이 ID는 데이터베이스의 기본 키로 사용된다.
- 62진법 변환을 적용, 생성한 ID를 단축 URL로 만든다.
- ID, 단축 URL, 원래 URL로 새 데이터베이스 레코드를 만든 후 단축 URL을 클라이언트에 전달한다.


(티켓 서버 ID 생성기 이용할 경우) 
- 입력된 URL 이 https:/naver.com 이라고 하자.
- 이 URL에 대해 ID 생성기가 반환한 ID는 200092156759483이다. (ID, longURL 먼저 삽입) 
- 이 ID를 62진수로 변환하면 zn9edcu를 얻는다. (변환한 62진수를 shortURL 업데이트 ) 



