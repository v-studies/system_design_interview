## 1단계: 문제 이해 및 설계 범위 
- '주변에 있다'= 지리적 기준 5마일
- 10억명 중에 10% 정도가 주변 친구 서비스를 사용한다.
- 사용자의 이동 이력을 보관해야한다.
- 친구 관계에 있는 사용자가 10분 이상 비활성 상태이면 해당 사용자를 주변 친구 목록에서 사라지게 한다.



## 주기적 위치 갱신

![image](https://github.com/user-attachments/assets/4e0b99dc-058c-4094-97f6-9331922a094a)


1. 모바일 클라이언트가 위치가 변경된 사실을 LoadBalancer에 전송
2. LoadBalancer는 위치 변경 내역을 웹소켓 서버로 전송
------------------------------------------------------
3. 웹소켓 서버는 해당 이벤틀르 위치 이동 이력 db에 저장 (3-5 병렬 수행) 
4. 웹소켓 서버는 새위치를 캐시에 보관
5. 레디스 펍/섭 서버에 해당 사용자 채널에 새 위치 이벤트 발행
--------------------------------------------------------------
6.  레디스 펍/섭 채널에 발행된 새로운 위치 변경 이벤트는 모든 구독자에게 broadcast 된다.
7.  웹소켓 서버는 '새 위치를 보낸 사용자'와 '메시지를 받은 사용자' 사이의 거리를 계산
8.  계산한 거리가 검색 반경을 넘지 않는다면, 새 위치를 해당 구독자의 클라이언트 앱으로 전송 (반경을 넘는다면 보내지 않음)

![image](https://github.com/user-attachments/assets/85d93736-4ec6-4f4a-ae15-922d72c43611)
