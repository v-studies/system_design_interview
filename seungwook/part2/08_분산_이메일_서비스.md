# 8장 분산 이메일 서비스


## 이메일 프로토콜

### 1. SMTP (Simple Mail Transfer Protocol)

- **이메일 보낼 때** 사용하는 프로토콜

- 수신은 담당하지 않음 (오직 발신 전용)

### 2. POP (Post Office Protocol)

- **이메일 받을 때**, 메일을 서버에서 다운로드해서 로컬에 저장

- 메일을 서버에서 가져오고, 보통 서버에서는 삭제됨

- 오프라인에서 메일을 볼 수 있음

- 여러 기기에서 메일을 동기화하는 데는 부적합

### 3. IMAP (Internet Message Access Protocol)
   
- **이메일 받을 때**, 서버에 메일을 보관하면서 동기화

- 여러 기기에서 메일을 동기화 가능

- 폴더 관리, 읽음 상태, 플래그 등 다양한 기능 지원

- 현재 대부분의 이메일 클라이언트는 IMAP을 선호

<br>

## 전통적 메일서버

![Image](https://github.com/user-attachments/assets/e47cc365-7075-436b-8446-1aafc5b0989c)

<br>

## 분산 메일서버

소수 사용자를 처리하는 이메일 서버 구성은 어렵지 않지만 한 대 이상의 서버로 규모를 늘리는 것은 까다롭다.

이는 전통적인 이메일 서버가 단일 장비 위에서만 동작하도록 설계되었고 여러 서버 사이에 데이터를 동기화 하는것은 어렵기 때문이다.

![Image](https://github.com/user-attachments/assets/e085129b-66b0-4f62-b783-4cb5d16f3382)

- 웹메일 
  - 사용자는 웹브라우저를 사용해 메일을 받고 보낸다.
- 웹서버 
  - 웹서버는 사용자가 이용하는 서비스로 로그인, 가입, 사용자 프로파일 등에 대한 관리 기능을 담당한다.
- 실시간 서버 
  - 새로운 이메일 내역을 클라이언트에 실시간으로 전달하는 역할을 한다.
  - 실시간 서버는 지속성 연결을 맺고 유지해야 하므로 상태 유지(stateful) 서버다.
  - 지원 방안으로는 롱 폴링이나 웹소켓 등이 있다.
- 메타데이터 데이터베이스
  - 이메일 제목, 본문, 등의 메타데이터를 저장하는 데이터베이스다.
- 첨부파일 저장소
  - S3 같은 객체 저장소를 사용한다.
- 분산 캐시
  - 최근에 수신된 이메일은 자주 읽을 가능성이 높으므로 메모리에 캐시해 사용한다.
- 검색 저장소
  - 분산 문서 저장소로 고속 텍스트 검색을 지원하는 역 인덱스 자료구조를 사용한다.

### 이메일 전송 절차

![Image](https://github.com/user-attachments/assets/79571cca-913a-4595-b74f-d04a0f160714)

### 이메일 수신 절차

![Image](https://github.com/user-attachments/assets/80935767-d0fd-4d2c-a315-1ebe739b3ab6)


