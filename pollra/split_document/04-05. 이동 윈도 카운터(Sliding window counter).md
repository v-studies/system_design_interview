- [[04-03. 고정 윈도 카운터(Fixed window counter)]] 와 [[04-04. 이동 윈도 로그(Sliding window log)]] 를 결합한 알고리즘
- 이 알고리즘을 구현하는 데에는 두 가지 접근법이 사용 될 수 있다
![[스크린샷 2024-11-17 오후 6.56.55.png]]
> [! 고민점]
> - 처리율 제한 장치의 한도가 분당 7개 요청으로 설정되어 있다
> - 이전 1분동안 5개의 요청이 왔다
> - 현재 1분동안 3개의 요청이 왔다
> - 현재 1분의 30% 시점에 도착한 새 요청의 경우, 몇 개의 요청이 온 것으로 보고 처리해야 할까?

 다음과 같이 계산 함

> - `현재 1분간의 요청 수` + `직전 1분간 요청 수` * `이동 윈도와 직전 1분이 겹치는 비율`
> 이 공식에 따라 계산 시 `3 + 5 * 70%` 이므로 6.5 가 된다
> 여기서 올림/내림 하여 쓸 수 있는데, 내림 하여 사용해보자

이 때의 값은 6 이므로 분당 7개의 요청보다 적기 때문에 요청은 허용된다
하지만 그 직후는 한도에 도달 하였으므로 더 이상 요청을 처리할 수 없다
# 장점
- 이전 시간대의 평균 처리율에 따라 현재 윈도의 상태를 계산하므로 짧은 시간에 몰리는 트래픽에도 잘 대응한다
- 메모리 효율이 좋다
# 단점
- 직전 시간대에 도착한 요청이 균등하게 분포되어 있다고 가정한 상태에서 추정치를 계산하기 때문에 다소 느슨하다
	- 위의 예제에서 계산식을 보면 70% 라고 되어 있는데, 이는 요청 갯수를 의미하는게 아니다. 따라서 느슨하다고 볼 수 있음
	- 단, 느슨한 문제는 심각하지는 않다. 클라우드플레어(Cloudflare)가 실시했던 실험에서는 40억개의 요청 가운데 시스템의 실제 상태와 맞지 않게 허용되거나 버려진 요청은 0.003% 불과 했다

